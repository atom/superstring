machine:
  environment:
    XCODE_SCHEME: test
    XCODE_WORKSPACE: test
    XCODE_PROJECT: test
    PATH: /usr/local/opt/python@2/libexec/bin:$PATH

  xcode:
    version: 8.2

dependencies:
  pre:
    - git submodule update --init
    - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.3/install.sh | bash
    - nvm install 8.4
    - nvm use 8.4
    - brew install python@2

  override:
    - npm install
    - script/install-emscripten.sh
    - npm run build:browser

  cache_directories:
    - $HOME/.nvm
    - $HOME/.emscripten_cache
    - emsdk-portable

test:
  override:
    - npm run standard
    - npm run test:browser
    - npm run test:node
    - npm run test:native

experimental:
  notify:
    branches:
      only:
        - master
